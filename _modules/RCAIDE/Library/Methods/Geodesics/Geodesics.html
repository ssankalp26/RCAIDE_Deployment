
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RCAIDE.Library.Methods.Geodesics.Geodesics &#8212; RCAIDE</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=d103512f" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/RCAIDE/Library/Methods/Geodesics/Geodesics';</script>
    <link rel="canonical" href="https://docs.rcaide.leadsresearchgroup.com/_modules/RCAIDE/Library/Methods/Geodesics/Geodesics.html" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../_static/leads_logo.png" class="logo__image only-light" alt=""/>
    <img src="../../../../../_static/leads_logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">RCAIDE</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../tutorials/tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../contributing.html">
    Contributing Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../api.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/leadsgroup/RCAIDE_LEADS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../tutorials/tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../contributing.html">
    Contributing Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../api.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/leadsgroup/RCAIDE_LEADS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">RCAIDE.Library.Methods.Geodesics.Geodesics</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for RCAIDE.Library.Methods.Geodesics.Geodesics</h1><div class="highlight"><pre>
<span></span><span class="c1"># RCAIDE/Library/Methods/Geodesics/Geodesics.py</span>
<span class="c1"># </span>
<span class="c1"># </span>
<span class="c1"># Adapted:  Oct 2024, A. Molloy</span>
<span class="c1">#</span>
<span class="c1"># This is a built-in adaptation of the Geopy distance claculation capabilities. It primarily serves to calcualte distances</span>
<span class="c1"># lat/long coordinate points. Minor adjustments have been made to better fit within the RCAIDE frameowkr (for instance, results</span>
<span class="c1"># only returned in kilometers).</span>
<span class="c1">#</span>
<span class="c1"># Distinct classes that are included in one palce here include the original Constants, Distance, Geodesic, </span>
<span class="c1"># GeodesicCapability, Geodesic_Calculate, and Math classes.</span>

<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">#  IMPORT</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------------------- </span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="sd">&quot;&quot;&quot;Evaluate the thrust produced by the energy network.</span>

<span class="sd">Assumptions:</span>
<span class="sd">    WGS-84 Ellipsoid model </span>

<span class="sd">Source:</span>
<span class="sd">    Karney, C. F., (2022) Geopy Python Code [source code]. https://geographiclib.sourceforge.io/</span>

<span class="sd">Args:</span>
<span class="sd">    </span>
<span class="sd">Returns:</span>
<span class="sd">     </span>
<span class="sd">&quot;&quot;&quot;</span> 

<span class="c1"># geodesic.py</span>
<span class="c1">#</span>
<span class="c1"># This is a rather literal translation of the GeographicLib::Geodesic class to</span>
<span class="c1"># python.  See the documentation for the C++ class for more information at</span>
<span class="c1">#</span>
<span class="c1">#    https://geographiclib.sourceforge.io/html/annotated.html</span>
<span class="c1">#</span>
<span class="c1"># The algorithms are derived in</span>
<span class="c1">#</span>
<span class="c1">#    Charles F. F. Karney,</span>
<span class="c1">#    Algorithms for geodesics, J. Geodesy 87, 43-55 (2013),</span>
<span class="c1">#    https://doi.org/10.1007/s00190-012-0578-z</span>
<span class="c1">#    Addenda: https://geographiclib.sourceforge.io/geod-addenda.html</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) Charles Karney (2011-2022) &lt;charles@karney.com&gt; and licensed</span>
<span class="c1"># under the MIT/X11 License.  For more information, see</span>
<span class="c1"># https://geographiclib.sourceforge.io/</span>
<span class="c1">######################################################################</span>

<div class="viewcode-block" id="Math">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math">[docs]</a>
<span class="k">class</span> <span class="nc">Math</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Additional math routines for GeographicLib.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Math.sq">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.sq">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sq</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Square a number&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span></div>


<div class="viewcode-block" id="Math.cbrt">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.cbrt">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cbrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Real cube root of a number&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Math.norm">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.norm">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: Normalize a two-vector.&quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
         <span class="c1"># hypot is inaccurate for 3.[89].  Problem reported by agdhruv</span>
         <span class="c1"># https://github.com/geopy/geopy/issues/466 ; see</span>
         <span class="c1"># https://bugs.python.org/issue43088</span>
         <span class="c1"># Visual Studio 2015 32-bit has a similar problem.</span>
         <span class="k">if</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">r</span></div>


<div class="viewcode-block" id="Math.sum">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.sum">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Error free transformation of a sum.&quot;&quot;&quot;</span>

        <span class="c1"># Error free transformation of a sum.  Note that t can be the same as one</span>
        <span class="c1"># of the first two arguments.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">v</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">v</span>
        <span class="n">vpp</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">up</span>
        <span class="n">up</span> <span class="o">-=</span> <span class="n">u</span>
        <span class="n">vpp</span> <span class="o">-=</span> <span class="n">v</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">up</span> <span class="o">+</span> <span class="n">vpp</span><span class="p">)</span>
        <span class="c1"># u + v =       s      + t</span>
        <span class="c1">#       = round(u + v) + t</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span></div>


<div class="viewcode-block" id="Math.polyval">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.polyval">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">polyval</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate a polynomial.&quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="c1"># make sure the returned value is a float</span>
        <span class="k">while</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="Math.AngRound">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.AngRound">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">AngRound</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: Round an angle so that small values underflow to zero.&quot;&quot;&quot;</span>

        <span class="c1"># The makes the smallest gap in x = 1/16 - nextafter(1/16, 0) = 1/2^57</span>
        <span class="c1"># for reals = 0.7 pm on the earth if x is an angle in degrees.  (This</span>
        <span class="c1"># is about 1000 times more resolution than we get with angles around 90</span>
        <span class="c1"># degrees.)  We use this to avoid having to deal with near singular</span>
        <span class="c1"># cases when x is non-zero but tiny (e.g., 1.0e-200).</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">16.0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># The compiler mustn&#39;t &quot;simplify&quot; z - (z - y) to y</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Math.remainder">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.remainder">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remainder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;remainder of x/y in the range [-y/2, y/2].&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Math.AngNormalize">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.AngNormalize">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">AngNormalize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;reduce angle to [-180,180]&quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mf">180.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">180</span> <span class="k">else</span> <span class="n">y</span></div>


<div class="viewcode-block" id="Math.LatFix">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.LatFix">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">LatFix</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;replace angles outside [-90,90] by NaN&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="k">else</span> <span class="n">x</span></div>


<div class="viewcode-block" id="Math.AngDiff">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.AngDiff">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">AngDiff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compute y - x and reduce to [-180,180] accurately&quot;&quot;&quot;</span>

        <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span> <span class="n">Math</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">360</span><span class="p">))</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span></div>


<div class="viewcode-block" id="Math.sincosd">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.sincosd">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sincosd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute sine and cosine of x in degrees.&quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="mi">90</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">-=</span> <span class="mi">90</span> <span class="o">*</span> <span class="n">q</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">r</span><span class="p">);</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="k">if</span>   <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span>
        <span class="k">elif</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span>
        <span class="k">elif</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">s</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span></div>


<div class="viewcode-block" id="Math.sincosde">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Math.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Math.sincosde">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sincosde</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute sine and cosine of (x + t) in degrees with x in [-180, 180]&quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">90</span><span class="p">))</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">90</span> <span class="o">*</span> <span class="n">q</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">AngRound</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">t</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">r</span><span class="p">);</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="k">if</span>   <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span>
        <span class="k">elif</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span>
        <span class="k">elif</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">s</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span></div>
</div>

 
<div class="viewcode-block" id="GeodesicCapability">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.GeodesicCapability.html#RCAIDE.Library.Methods.Geodesics.Geodesics.GeodesicCapability">[docs]</a>
<span class="k">class</span> <span class="nc">GeodesicCapability</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Capability constants shared between Geodesic and GeodesicLine.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CAP_NONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CAP_C1</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
    <span class="n">CAP_C1p</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
    <span class="n">CAP_C2</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
    <span class="n">CAP_C3</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>
    <span class="n">CAP_C4</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>
    <span class="n">CAP_ALL</span>  <span class="o">=</span> <span class="mh">0x1F</span>
    <span class="n">CAP_MASK</span> <span class="o">=</span> <span class="n">CAP_ALL</span>
    <span class="n">OUT_ALL</span>  <span class="o">=</span> <span class="mh">0x7F80</span>
    <span class="n">OUT_MASK</span> <span class="o">=</span> <span class="mh">0xFF80</span>             <span class="c1"># Includes LONG_UNROLL</span>
    <span class="n">EMPTY</span>         <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LATITUDE</span>      <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span>  <span class="o">|</span> <span class="n">CAP_NONE</span>
    <span class="n">LONGITUDE</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>  <span class="o">|</span> <span class="n">CAP_C3</span>
    <span class="n">AZIMUTH</span>       <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span>  <span class="o">|</span> <span class="n">CAP_NONE</span>
    <span class="n">DISTANCE</span>      <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span> <span class="o">|</span> <span class="n">CAP_C1</span>
    <span class="n">STANDARD</span>      <span class="o">=</span> <span class="n">LATITUDE</span> <span class="o">|</span> <span class="n">LONGITUDE</span> <span class="o">|</span> <span class="n">AZIMUTH</span> <span class="o">|</span> <span class="n">DISTANCE</span>
    <span class="n">DISTANCE_IN</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span> <span class="o">|</span> <span class="n">CAP_C1</span> <span class="o">|</span> <span class="n">CAP_C1p</span>
    <span class="n">REDUCEDLENGTH</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span> <span class="o">|</span> <span class="n">CAP_C1</span> <span class="o">|</span> <span class="n">CAP_C2</span>
    <span class="n">GEODESICSCALE</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span> <span class="o">|</span> <span class="n">CAP_C1</span> <span class="o">|</span> <span class="n">CAP_C2</span>
    <span class="n">AREA</span>          <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span> <span class="o">|</span> <span class="n">CAP_C4</span>
    <span class="n">LONG_UNROLL</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span>
    <span class="n">ALL</span>           <span class="o">=</span> <span class="n">OUT_ALL</span> <span class="o">|</span> <span class="n">CAP_ALL</span> <span class="c1"># Does not include LONG_UNROLL</span></div>



<div class="viewcode-block" id="Constants">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Constants.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Constants">[docs]</a>
<span class="k">class</span> <span class="nc">Constants</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constants describing the WGS84 ellipsoid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WGS84_a</span> <span class="o">=</span> <span class="mf">6378137.0</span>           <span class="c1"># meters</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the equatorial radius in meters of the WGS84 ellipsoid in meters&quot;&quot;&quot;</span>
    <span class="n">WGS84_f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">298.257223563</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;the flattening of the WGS84 ellipsoid, 1/298.257223563&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Geodesic">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic">[docs]</a>
<span class="k">class</span> <span class="nc">Geodesic</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solve geodesic problems&quot;&quot;&quot;</span>

    <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">nA1_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nC1_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nC1p_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nA2_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nC2_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nA3_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nA3x_</span> <span class="o">=</span> <span class="n">nA3_</span>
    <span class="n">nC3_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nC3x_</span> <span class="o">=</span> <span class="p">(</span><span class="n">nC3_</span> <span class="o">*</span> <span class="p">(</span><span class="n">nC3_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">nC4_</span> <span class="o">=</span> <span class="n">GEOGRAPHICLIB_GEODESIC_ORDER</span>
    <span class="n">nC4x_</span> <span class="o">=</span> <span class="p">(</span><span class="n">nC4_</span> <span class="o">*</span> <span class="p">(</span><span class="n">nC4_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">maxit1_</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">maxit2_</span> <span class="o">=</span> <span class="n">maxit1_</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">mant_dig</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="n">tiny_</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
    <span class="n">tol0_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">tol1_</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">tol0_</span>
    <span class="n">tol2_</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tol0_</span><span class="p">)</span>
    <span class="n">tolb_</span> <span class="o">=</span> <span class="n">tol0_</span> <span class="o">*</span> <span class="n">tol2_</span>
    <span class="n">xthresh_</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">tol2_</span>

    <span class="n">CAP_NONE</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_NONE</span>
    <span class="n">CAP_C1</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_C1</span>
    <span class="n">CAP_C1p</span>  <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_C1p</span>
    <span class="n">CAP_C2</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_C2</span>
    <span class="n">CAP_C3</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_C3</span>
    <span class="n">CAP_C4</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_C4</span>
    <span class="n">CAP_ALL</span>  <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_ALL</span>
    <span class="n">CAP_MASK</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">CAP_MASK</span>
    <span class="n">OUT_ALL</span>  <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">OUT_ALL</span>
    <span class="n">OUT_MASK</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">OUT_MASK</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_SinCosSeries</span><span class="p">(</span><span class="n">sinp</span><span class="p">,</span> <span class="n">sinx</span><span class="p">,</span> <span class="n">cosx</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: Evaluate a trig series using Clenshaw summation.&quot;&quot;&quot;</span>
        <span class="c1"># Evaluate</span>
        <span class="c1"># y = sinp ? sum(c[i] * sin( 2*i    * x), i, 1, n) :</span>
        <span class="c1">#            sum(c[i] * cos((2*i+1) * x), i, 0, n-1)</span>
        <span class="c1"># using Clenshaw summation.  N.B. c[0] is unused for sin series</span>
        <span class="c1"># Approx operation count = (n + 5) mult and (2 * n + 2) add</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>                  <span class="c1"># Point to one beyond last element</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">sinp</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">cosx</span> <span class="o">-</span> <span class="n">sinx</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cosx</span> <span class="o">+</span> <span class="n">sinx</span><span class="p">)</span> <span class="c1"># 2 * cos(2 * x)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>                                 <span class="c1"># accumulators for sum</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Now n is even</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">n</span><span class="p">:</span>                    <span class="c1"># while n--:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="c1"># Unroll loop x 2, so accumulators return to their original role</span>
            <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">ar</span> <span class="o">*</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">ar</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sinx</span> <span class="o">*</span> <span class="n">cosx</span> <span class="o">*</span> <span class="n">y0</span> <span class="k">if</span> <span class="n">sinp</span> <span class="c1"># sin(2 * x) * y0</span>
             <span class="k">else</span> <span class="n">cosx</span> <span class="o">*</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="p">)</span>      <span class="c1"># cos(x) * (y0 - y1)</span>
 

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_A1m1f</span><span class="p">(</span><span class="n">eps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return A1-1.&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nA1_</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">eps</span><span class="p">))</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_C1f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return C1.&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span>
      <span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">eps2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC1_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># l is index of C1p[l]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC1_</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>        <span class="c1"># order of polynomial in eps^2</span>
            <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">eps2</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">d</span> <span class="o">*=</span> <span class="n">eps</span>
            
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_A2m1f</span><span class="p">(</span><span class="n">eps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return A2-1&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">28</span><span class="p">,</span> <span class="o">-</span><span class="mi">192</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nA2_</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">eps</span><span class="p">))</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_C2f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return C2&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
      <span class="mi">35</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span>
      <span class="mi">15</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span>
      <span class="mi">7</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span>
      <span class="mi">63</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span>
      <span class="mi">77</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">eps2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC2_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># l is index of C2[l]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC2_</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>        <span class="c1"># order of polynomial in eps^2</span>
            <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">eps2</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">d</span> <span class="o">*=</span> <span class="n">eps</span>

<div class="viewcode-block" id="Geodesic.__init__">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a Geodesic object</span>

<span class="sd">        :param a: the equatorial radius of the ellipsoid in meters</span>
<span class="sd">        :param f: the flattening of the ellipsoid</span>

<span class="sd">        An exception is thrown if *a* or the polar semi-axis *b* = *a* (1 -</span>
<span class="sd">        *f*) is not a finite positive quantity.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The equatorial radius in meters (readonly)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The flattening (readonly)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e2</span> <span class="o">/</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f1</span><span class="p">)</span> <span class="c1"># e2 / (1 - e2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span>
        <span class="c1"># authalic radius squared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">)</span> <span class="o">*</span>
                <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                 <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atanh</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_e2</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span>
                  <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_e2</span><span class="p">)))</span> <span class="o">/</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_e2</span><span class="p">))))</span><span class="o">/</span><span class="mi">2</span>
        <span class="c1"># The sig12 threshold for &quot;really short&quot;.  Using the auxiliary sphere</span>
        <span class="c1"># solution with dnm computed at (bet1 + bet2) / 2, the relative error in</span>
        <span class="c1"># the azimuth consistency check is sig12^2 * abs(f) * min(1, 1-f/2) / 2.</span>
        <span class="c1"># (Error measured for 1/100 &lt; b/a &lt; 100 and abs(f) &gt;= 1/1000.  For a given</span>
        <span class="c1"># f and sig12, the max error occurs for lines near the pole.  If the old</span>
        <span class="c1"># rule for computing dnm = (dn1 + dn2)/2 is used, then the error increases</span>
        <span class="c1"># by a factor of 2.)  Setting this equal to epsilon gives sig12 = etol2.</span>
        <span class="c1"># Here 0.1 is a safety factor (error decreased by 100) and max(0.001,</span>
        <span class="c1"># abs(f)) stops etol2 getting too large in the nearly spherical case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_etol2</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tol2_</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span> <span class="o">*</span>
                                                    <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Equatorial radius is not positive&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Polar semi-axis is not positive&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A3x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nA3x_</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_C3x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3x_</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_C4x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC4x_</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A3coeff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_C3coeff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_C4coeff</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_A3coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return coefficients for A3&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nA3_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># coeff of eps^j</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nA3_</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="c1"># order of polynomial in n</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A3x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_C3coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return coefficients for C3&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
      <span class="mi">5</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
      <span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span>
      <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span>
      <span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span>
      <span class="mi">21</span><span class="p">,</span> <span class="mi">2560</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span><span class="p">):</span> <span class="c1"># l is index of C3[l]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># coeff of eps^j</span>
                <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="c1"># order of polynomial in n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_C3x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_C4coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return coefficients for C4&quot;&quot;&quot;</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">97</span><span class="p">,</span> <span class="mi">15015</span><span class="p">,</span>
      <span class="mi">1088</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">45045</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">224</span><span class="p">,</span> <span class="o">-</span><span class="mi">4784</span><span class="p">,</span> <span class="mi">1573</span><span class="p">,</span> <span class="mi">45045</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">10656</span><span class="p">,</span> <span class="mi">14144</span><span class="p">,</span> <span class="o">-</span><span class="mi">4576</span><span class="p">,</span> <span class="o">-</span><span class="mi">858</span><span class="p">,</span> <span class="mi">45045</span><span class="p">,</span>
      <span class="mi">64</span><span class="p">,</span> <span class="mi">624</span><span class="p">,</span> <span class="o">-</span><span class="mi">4576</span><span class="p">,</span> <span class="mi">6864</span><span class="p">,</span> <span class="o">-</span><span class="mi">3003</span><span class="p">,</span> <span class="mi">15015</span><span class="p">,</span>
      <span class="mi">100</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">572</span><span class="p">,</span> <span class="mi">3432</span><span class="p">,</span> <span class="o">-</span><span class="mi">12012</span><span class="p">,</span> <span class="mi">30030</span><span class="p">,</span> <span class="mi">45045</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span> <span class="mi">9009</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">2944</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">135135</span><span class="p">,</span>
      <span class="mi">5792</span><span class="p">,</span> <span class="mi">1040</span><span class="p">,</span> <span class="o">-</span><span class="mi">1287</span><span class="p">,</span> <span class="mi">135135</span><span class="p">,</span>
      <span class="mi">5952</span><span class="p">,</span> <span class="o">-</span><span class="mi">11648</span><span class="p">,</span> <span class="mi">9152</span><span class="p">,</span> <span class="o">-</span><span class="mi">2574</span><span class="p">,</span> <span class="mi">135135</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">64</span><span class="p">,</span> <span class="o">-</span><span class="mi">624</span><span class="p">,</span> <span class="mi">4576</span><span class="p">,</span> <span class="o">-</span><span class="mi">6864</span><span class="p">,</span> <span class="mi">3003</span><span class="p">,</span> <span class="mi">135135</span><span class="p">,</span>
      <span class="mi">8</span><span class="p">,</span> <span class="mi">10725</span><span class="p">,</span>
      <span class="mi">1856</span><span class="p">,</span> <span class="o">-</span><span class="mi">936</span><span class="p">,</span> <span class="mi">225225</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">8448</span><span class="p">,</span> <span class="mi">4992</span><span class="p">,</span> <span class="o">-</span><span class="mi">1144</span><span class="p">,</span> <span class="mi">225225</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">1440</span><span class="p">,</span> <span class="mi">4160</span><span class="p">,</span> <span class="o">-</span><span class="mi">4576</span><span class="p">,</span> <span class="mi">1716</span><span class="p">,</span> <span class="mi">225225</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">136</span><span class="p">,</span> <span class="mi">63063</span><span class="p">,</span>
      <span class="mi">1024</span><span class="p">,</span> <span class="o">-</span><span class="mi">208</span><span class="p">,</span> <span class="mi">105105</span><span class="p">,</span>
      <span class="mi">3584</span><span class="p">,</span> <span class="o">-</span><span class="mi">3328</span><span class="p">,</span> <span class="mi">1144</span><span class="p">,</span> <span class="mi">315315</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">135135</span><span class="p">,</span>
      <span class="o">-</span><span class="mi">2560</span><span class="p">,</span> <span class="mi">832</span><span class="p">,</span> <span class="mi">405405</span><span class="p">,</span>
      <span class="mi">128</span><span class="p">,</span> <span class="mi">99099</span><span class="p">,</span>
    <span class="p">]</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC4_</span><span class="p">):</span> <span class="c1"># l is index of C4[l]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC4_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># coeff of eps^j</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC4_</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># order of polynomial in n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_C4x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span> <span class="o">/</span> <span class="n">coeff</span><span class="p">[</span><span class="n">o</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_A3f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return A3&quot;&quot;&quot;</span>
        <span class="c1"># Evaluate A3</span>
        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nA3_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A3x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_C3f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return C3&quot;&quot;&quot;</span>
        <span class="c1"># Evaluate C3</span>
        <span class="c1"># Elements c[1] thru c[nC3_ - 1] are set</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span><span class="p">):</span> <span class="c1"># l is index of C3[l]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span>       <span class="c1"># order of polynomial in eps</span>
            <span class="n">mult</span> <span class="o">*=</span> <span class="n">eps</span>
            <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_C3x</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> 

    <span class="c1"># return s12b, m12b, m0, M12, M21</span>
    <span class="k">def</span> <span class="nf">_Lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span>
               <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">outmask</span><span class="p">,</span>
               <span class="c1"># Scratch areas of the right size</span>
               <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: return a bunch of lengths&quot;&quot;&quot;</span>
        <span class="c1"># Return s12b, m12b, m0, M12, M21, where</span>
        <span class="c1"># m12b = (reduced length)/_b; s12b = distance/_b,</span>
        <span class="c1"># m0 = coefficient of secular term in expression for reduced length.</span>
        <span class="n">outmask</span> <span class="o">&amp;=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">OUT_MASK</span>
        <span class="c1"># outmask &amp; DISTANCE: set s12b</span>
        <span class="c1"># outmask &amp; REDUCEDLENGTH: set m12b &amp; m0</span>
        <span class="c1"># outmask &amp; GEODESICSCALE: set M12 &amp; M21</span>

        <span class="n">s12b</span> <span class="o">=</span> <span class="n">m12b</span> <span class="o">=</span> <span class="n">m0</span> <span class="o">=</span> <span class="n">M12</span> <span class="o">=</span> <span class="n">M21</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span> <span class="o">|</span>
                  <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">):</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">_A1m1f</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
            <span class="n">Geodesic</span><span class="o">.</span><span class="n">_C1f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">C1a</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">):</span>
                <span class="n">A2</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">_A2m1f</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
                <span class="n">Geodesic</span><span class="o">.</span><span class="n">_C2f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>
                <span class="n">m0x</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">A2</span>
                <span class="n">A2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">A2</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">A1</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">:</span>
            <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">C1a</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">C1a</span><span class="p">))</span>
            <span class="c1"># Missing a factor of _b</span>
            <span class="n">s12b</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig12</span> <span class="o">+</span> <span class="n">B1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">):</span>
                <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span> <span class="o">-</span>
              <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">C2a</span><span class="p">))</span>
                <span class="n">J12</span> <span class="o">=</span> <span class="n">m0x</span> <span class="o">*</span> <span class="n">sig12</span> <span class="o">+</span> <span class="p">(</span><span class="n">A1</span> <span class="o">*</span> <span class="n">B1</span> <span class="o">-</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">B2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">):</span>
            <span class="c1"># Assume here that nC1_ &gt;= nC2_</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">nC2_</span><span class="p">):</span>
                <span class="n">C2a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">*</span> <span class="n">C1a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">-</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">C2a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="n">J12</span> <span class="o">=</span> <span class="n">m0x</span> <span class="o">*</span> <span class="n">sig12</span> <span class="o">+</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span> <span class="o">-</span>
                           <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">C2a</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">:</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">m0x</span>
            <span class="c1"># Missing a factor of _b.</span>
            <span class="c1"># Add parens around (csig1 * ssig2) and (ssig1 * csig2) to ensure</span>
            <span class="c1"># accurate cancellation in the case of coincident points.</span>
            <span class="n">m12b</span> <span class="o">=</span> <span class="p">(</span><span class="n">dn2</span> <span class="o">*</span> <span class="p">(</span><span class="n">csig1</span> <span class="o">*</span> <span class="n">ssig2</span><span class="p">)</span> <span class="o">-</span> <span class="n">dn1</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssig1</span> <span class="o">*</span> <span class="n">csig2</span><span class="p">)</span> <span class="o">-</span>
              <span class="n">csig1</span> <span class="o">*</span> <span class="n">csig2</span> <span class="o">*</span> <span class="n">J12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">:</span>
            <span class="n">csig12</span> <span class="o">=</span> <span class="n">csig1</span> <span class="o">*</span> <span class="n">csig2</span> <span class="o">+</span> <span class="n">ssig1</span> <span class="o">*</span> <span class="n">ssig2</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span> <span class="o">*</span> <span class="p">(</span><span class="n">cbet1</span> <span class="o">-</span> <span class="n">cbet2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cbet1</span> <span class="o">+</span> <span class="n">cbet2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dn1</span> <span class="o">+</span> <span class="n">dn2</span><span class="p">)</span>
            <span class="n">M12</span> <span class="o">=</span> <span class="n">csig12</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">ssig2</span> <span class="o">-</span> <span class="n">csig2</span> <span class="o">*</span> <span class="n">J12</span><span class="p">)</span> <span class="o">*</span> <span class="n">ssig1</span> <span class="o">/</span> <span class="n">dn1</span>
            <span class="n">M21</span> <span class="o">=</span> <span class="n">csig12</span> <span class="o">-</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">ssig1</span> <span class="o">-</span> <span class="n">csig1</span> <span class="o">*</span> <span class="n">J12</span><span class="p">)</span> <span class="o">*</span> <span class="n">ssig2</span> <span class="o">/</span> <span class="n">dn2</span>
        <span class="k">return</span> <span class="n">s12b</span><span class="p">,</span> <span class="n">m12b</span><span class="p">,</span> <span class="n">m0</span><span class="p">,</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span>

    <span class="c1"># return sig12, salp1, calp1, salp2, calp2, dnm</span>
    <span class="k">def</span> <span class="nf">_InverseStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span>
                    <span class="n">lam12</span><span class="p">,</span> <span class="n">slam12</span><span class="p">,</span> <span class="n">clam12</span><span class="p">,</span>
                    <span class="c1"># Scratch areas of the right size</span>
                    <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: Find a starting value for Newton&#39;s method.&quot;&quot;&quot;</span>
        <span class="c1"># Return a starting point for Newton&#39;s method in salp1 and calp1 (function</span>
        <span class="c1"># value is -1).  If Newton&#39;s method doesn&#39;t need to be used, return also</span>
        <span class="c1"># salp2 and calp2 and function value is sig12.</span>
        <span class="n">sig12</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">salp2</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">=</span> <span class="n">dnm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># Return values</span>
        <span class="c1"># bet12 = bet2 - bet1 in [0, pi); bet12a = bet2 + bet1 in (-pi, 0]</span>
        <span class="n">sbet12</span> <span class="o">=</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="n">cbet1</span> <span class="o">-</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">sbet1</span>
        <span class="n">cbet12</span> <span class="o">=</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">cbet1</span> <span class="o">+</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="n">sbet1</span>
        <span class="c1"># Volatile declaration needed to fix inverse cases</span>
        <span class="c1"># 88.202499451857 0 -88.202499451857 179.981022032992859592</span>
        <span class="c1"># 89.262080389218 0 -89.262080389218 179.992207982775375662</span>
        <span class="c1"># 89.333123580033 0 -89.333123580032997687 179.99295812360148422</span>
        <span class="c1"># which otherwise fail with g++ 4.4.4 x86 -O3</span>
        <span class="n">sbet12a</span> <span class="o">=</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="n">cbet1</span>
        <span class="n">sbet12a</span> <span class="o">+=</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">sbet1</span>

        <span class="n">shortline</span> <span class="o">=</span> <span class="n">cbet12</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sbet12</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">lam12</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">shortline</span><span class="p">:</span>
            <span class="n">sbetm2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">sbet1</span> <span class="o">+</span> <span class="n">sbet2</span><span class="p">)</span>
            <span class="c1"># sin((bet1+bet2)/2)^2</span>
            <span class="c1"># =  (sbet1 + sbet2)^2 / ((sbet1 + sbet2)^2 + (cbet1 + cbet2)^2)</span>
            <span class="n">sbetm2</span> <span class="o">/=</span> <span class="n">sbetm2</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">cbet1</span> <span class="o">+</span> <span class="n">cbet2</span><span class="p">)</span>
            <span class="n">dnm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span> <span class="o">*</span> <span class="n">sbetm2</span><span class="p">)</span>
            <span class="n">omg12</span> <span class="o">=</span> <span class="n">lam12</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f1</span> <span class="o">*</span> <span class="n">dnm</span><span class="p">)</span>
            <span class="n">somg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omg12</span><span class="p">);</span> <span class="n">comg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omg12</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">somg12</span> <span class="o">=</span> <span class="n">slam12</span><span class="p">;</span> <span class="n">comg12</span> <span class="o">=</span> <span class="n">clam12</span>

        <span class="n">salp1</span> <span class="o">=</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">somg12</span>
        <span class="n">calp1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sbet12</span> <span class="o">+</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">somg12</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">comg12</span><span class="p">)</span> <span class="k">if</span> <span class="n">comg12</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">else</span> <span class="n">sbet12a</span> <span class="o">-</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">somg12</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">comg12</span><span class="p">))</span>

        <span class="n">ssig12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">)</span>
        <span class="n">csig12</span> <span class="o">=</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">sbet2</span> <span class="o">+</span> <span class="n">cbet1</span> <span class="o">*</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">comg12</span>

        <span class="k">if</span> <span class="n">shortline</span> <span class="ow">and</span> <span class="n">ssig12</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_etol2</span><span class="p">:</span>
            <span class="c1"># really short lines</span>
            <span class="n">salp2</span> <span class="o">=</span> <span class="n">cbet1</span> <span class="o">*</span> <span class="n">somg12</span>
            <span class="n">calp2</span> <span class="o">=</span> <span class="n">sbet12</span> <span class="o">-</span> <span class="n">cbet1</span> <span class="o">*</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">somg12</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">comg12</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">comg12</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">comg12</span><span class="p">)</span>
            <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">)</span>
            <span class="c1"># Set return value</span>
            <span class="n">sig12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">ssig12</span><span class="p">,</span> <span class="n">csig12</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="ow">or</span> <span class="c1"># Skip astroid calc if too eccentric</span>
          <span class="n">csig12</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span>
          <span class="n">ssig12</span> <span class="o">&gt;=</span> <span class="mi">6</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">cbet1</span><span class="p">)):</span>
            <span class="c1"># Nothing to do, zeroth order spherical approximation is OK</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Scale lam12 and bet2 to x, y coordinate system where antipodal point</span>
            <span class="c1"># is at origin and singular point is at y = 0, x = -1.</span>
            <span class="c1"># real y, lamscale, betscale</span>
            <span class="n">lam12x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">slam12</span><span class="p">,</span> <span class="o">-</span><span class="n">clam12</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>            <span class="c1"># In fact f == 0 does not get here</span>
                <span class="c1"># x = dlong, y = dlat</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">sbet1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">))</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>
                <span class="n">lamscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">cbet1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A3f</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">betscale</span> <span class="o">=</span> <span class="n">lamscale</span> <span class="o">*</span> <span class="n">cbet1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">lam12x</span> <span class="o">/</span> <span class="n">lamscale</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">sbet12a</span> <span class="o">/</span> <span class="n">betscale</span>
            <span class="k">else</span><span class="p">:</span>                     <span class="c1"># _f &lt; 0</span>
                <span class="c1"># x = dlat, y = dlong</span>
                <span class="n">cbet12a</span> <span class="o">=</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">cbet1</span> <span class="o">-</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="n">sbet1</span>
                <span class="n">bet12a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">sbet12a</span><span class="p">,</span> <span class="n">cbet12a</span><span class="p">)</span>
                <span class="c1"># real m12b, m0, dummy</span>
                <span class="c1"># In the case of lon12 = 180, this repeats a calculation made in</span>
                <span class="c1"># Inverse.</span>
                <span class="n">dummy</span><span class="p">,</span> <span class="n">m12b</span><span class="p">,</span> <span class="n">m0</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lengths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">bet12a</span><span class="p">,</span> <span class="n">sbet1</span><span class="p">,</span> <span class="o">-</span><span class="n">cbet1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span>
          <span class="n">cbet1</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">,</span> <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">m12b</span> <span class="o">/</span> <span class="p">(</span><span class="n">cbet1</span> <span class="o">*</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">betscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">sbet12a</span> <span class="o">/</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span>
                    <span class="k">else</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">cbet1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">lamscale</span> <span class="o">=</span> <span class="n">betscale</span> <span class="o">/</span> <span class="n">cbet1</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">lam12x</span> <span class="o">/</span> <span class="n">lamscale</span>

            <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">tol1_</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">xthresh_</span><span class="p">:</span>
                <span class="c1"># strip near cut</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">salp1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">);</span> <span class="n">calp1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">salp1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">calp1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="mf">0.0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">tol1_</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
                    <span class="n">salp1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">calp1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Estimate alp1, by solving the astroid problem.</span>
                <span class="c1">#</span>
                <span class="c1"># Could estimate alpha1 = theta + pi/2, directly, i.e.,</span>
                <span class="c1">#   calp1 = y/k; salp1 = -x/(1+k);  for _f &gt;= 0</span>
                <span class="c1">#   calp1 = x/(1+k); salp1 = -y/k;  for _f &lt; 0 (need to check)</span>
                <span class="c1">#</span>
                <span class="c1"># However, it&#39;s better to estimate omg12 from astroid and use</span>
                <span class="c1"># spherical formula to compute alp1.  This reduces the mean number of</span>
                <span class="c1"># Newton iterations for astroid cases from 2.24 (min 0, max 6) to 2.12</span>
                <span class="c1"># (min 0 max 5).  The changes in the number of iterations are as</span>
                <span class="c1"># follows:</span>
                <span class="c1">#</span>
                <span class="c1"># change percent</span>
                <span class="c1">#    1       5</span>
                <span class="c1">#    0      78</span>
                <span class="c1">#   -1      16</span>
                <span class="c1">#   -2       0.6</span>
                <span class="c1">#   -3       0.04</span>
                <span class="c1">#   -4       0.002</span>
                <span class="c1">#</span>
                <span class="c1"># The histogram of iterations is (m = number of iterations estimating</span>
                <span class="c1"># alp1 directly, n = number of iterations estimating via omg12, total</span>
                <span class="c1"># number of trials = 148605):</span>
                <span class="c1">#</span>
                <span class="c1">#  iter    m      n</span>
                <span class="c1">#    0   148    186</span>
                <span class="c1">#    1 13046  13845</span>
                <span class="c1">#    2 93315 102225</span>
                <span class="c1">#    3 36189  32341</span>
                <span class="c1">#    4  5396      7</span>
                <span class="c1">#    5   455      1</span>
                <span class="c1">#    6    56      0</span>
                <span class="c1">#</span>
                <span class="c1"># Because omg12 is near pi, estimate work with omg12a = pi - omg12</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">_Astroid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">omg12a</span> <span class="o">=</span> <span class="n">lamscale</span> <span class="o">*</span> <span class="p">(</span> <span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                              <span class="k">else</span> <span class="o">-</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">k</span> <span class="p">)</span>
                <span class="n">somg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omg12a</span><span class="p">);</span> <span class="n">comg12</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omg12a</span><span class="p">)</span>
                <span class="c1"># Update spherical estimate of alp1 using omg12 instead of lam12</span>
                <span class="n">salp1</span> <span class="o">=</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">somg12</span>
                <span class="n">calp1</span> <span class="o">=</span> <span class="n">sbet12a</span> <span class="o">-</span> <span class="n">cbet2</span> <span class="o">*</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">somg12</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">comg12</span><span class="p">)</span>
        <span class="c1"># Sanity check on starting guess.  Backwards check allows NaN through.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">salp1</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">salp1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">calp1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">,</span> <span class="n">dnm</span>

    <span class="c1"># return lam12, salp2, calp2, sig12, ssig1, csig1, ssig2, csig2, eps,</span>
    <span class="c1"># domg12, dlam12</span>
    
    <span class="k">def</span> <span class="nf">_Lambda12</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">,</span>
                <span class="n">slam120</span><span class="p">,</span> <span class="n">clam120</span><span class="p">,</span> <span class="n">diffp</span><span class="p">,</span>
                <span class="c1"># Scratch areas of the right size</span>
                <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">,</span> <span class="n">C3a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: Solve hybrid problem&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sbet1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">calp1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Break degeneracy of equatorial line.  This case has already been</span>
            <span class="c1"># handled.</span>
            <span class="n">calp1</span> <span class="o">=</span> <span class="o">-</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span>

        <span class="c1"># sin(alp1) * cos(bet1) = sin(alp0)</span>
        <span class="n">salp0</span> <span class="o">=</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">cbet1</span>
        <span class="n">calp0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">calp1</span><span class="p">,</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">sbet1</span><span class="p">)</span> <span class="c1"># calp0 &gt; 0</span>

        <span class="c1"># real somg1, comg1, somg2, comg2, lam12</span>
        <span class="c1"># tan(bet1) = tan(sig1) * cos(alp1)</span>
        <span class="c1"># tan(omg1) = sin(alp0) * tan(sig1) = tan(omg1)=tan(alp1)*sin(bet1)</span>
        <span class="n">ssig1</span> <span class="o">=</span> <span class="n">sbet1</span><span class="p">;</span> <span class="n">somg1</span> <span class="o">=</span> <span class="n">salp0</span> <span class="o">*</span> <span class="n">sbet1</span>
        <span class="n">csig1</span> <span class="o">=</span> <span class="n">comg1</span> <span class="o">=</span> <span class="n">calp1</span> <span class="o">*</span> <span class="n">cbet1</span>
        <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">)</span>
        <span class="c1"># Math.norm(somg1, comg1); -- don&#39;t need to normalize!</span>

        <span class="c1"># Enforce symmetries in the case abs(bet2) = -bet1.  Need to be careful</span>
        <span class="c1"># about this case, since this can yield singularities in the Newton</span>
        <span class="c1"># iteration.</span>
        <span class="c1"># sin(alp2) * cos(bet2) = sin(alp0)</span>
        <span class="n">salp2</span> <span class="o">=</span> <span class="n">salp0</span> <span class="o">/</span> <span class="n">cbet2</span> <span class="k">if</span> <span class="n">cbet2</span> <span class="o">!=</span> <span class="n">cbet1</span> <span class="k">else</span> <span class="n">salp1</span>
        <span class="c1"># calp2 = sqrt(1 - sq(salp2))</span>
        <span class="c1">#       = sqrt(sq(calp0) - sq(sbet2)) / cbet2</span>
        <span class="c1"># and subst for calp0 and rearrange to give (choose positive sqrt</span>
        <span class="c1"># to give alp2 in [0, pi/2]).</span>
        <span class="n">calp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">calp1</span> <span class="o">*</span> <span class="n">cbet1</span><span class="p">)</span> <span class="o">+</span>
                       <span class="p">((</span><span class="n">cbet2</span> <span class="o">-</span> <span class="n">cbet1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cbet1</span> <span class="o">+</span> <span class="n">cbet2</span><span class="p">)</span> <span class="k">if</span> <span class="n">cbet1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">sbet1</span>
                        <span class="k">else</span> <span class="p">(</span><span class="n">sbet1</span> <span class="o">-</span> <span class="n">sbet2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sbet1</span> <span class="o">+</span> <span class="n">sbet2</span><span class="p">)))</span> <span class="o">/</span> <span class="n">cbet2</span>
             <span class="k">if</span> <span class="n">cbet2</span> <span class="o">!=</span> <span class="n">cbet1</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sbet2</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="n">sbet1</span> <span class="k">else</span> <span class="nb">abs</span><span class="p">(</span><span class="n">calp1</span><span class="p">))</span>
        <span class="c1"># tan(bet2) = tan(sig2) * cos(alp2)</span>
        <span class="c1"># tan(omg2) = sin(alp0) * tan(sig2).</span>
        <span class="n">ssig2</span> <span class="o">=</span> <span class="n">sbet2</span><span class="p">;</span> <span class="n">somg2</span> <span class="o">=</span> <span class="n">salp0</span> <span class="o">*</span> <span class="n">sbet2</span>
        <span class="n">csig2</span> <span class="o">=</span> <span class="n">comg2</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">*</span> <span class="n">cbet2</span>
        <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">)</span>
        <span class="c1"># Math.norm(somg2, comg2); -- don&#39;t need to normalize!</span>

        <span class="c1"># sig12 = sig2 - sig1, limit to [0, pi]</span>
        <span class="n">sig12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">csig1</span> <span class="o">*</span> <span class="n">ssig2</span> <span class="o">-</span> <span class="n">ssig1</span> <span class="o">*</span> <span class="n">csig2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">,</span>
                       <span class="n">csig1</span> <span class="o">*</span> <span class="n">csig2</span> <span class="o">+</span> <span class="n">ssig1</span> <span class="o">*</span> <span class="n">ssig2</span><span class="p">)</span>

        <span class="c1"># omg12 = omg2 - omg1, limit to [0, pi]</span>
        <span class="n">somg12</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">comg1</span> <span class="o">*</span> <span class="n">somg2</span> <span class="o">-</span> <span class="n">somg1</span> <span class="o">*</span> <span class="n">comg2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span>
        <span class="n">comg12</span> <span class="o">=</span>          <span class="n">comg1</span> <span class="o">*</span> <span class="n">comg2</span> <span class="o">+</span> <span class="n">somg1</span> <span class="o">*</span> <span class="n">somg2</span>
        <span class="c1"># eta = omg12 - lam120</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">somg12</span> <span class="o">*</span> <span class="n">clam120</span> <span class="o">-</span> <span class="n">comg12</span> <span class="o">*</span> <span class="n">slam120</span><span class="p">,</span>
                     <span class="n">comg12</span> <span class="o">*</span> <span class="n">clam120</span> <span class="o">+</span> <span class="n">somg12</span> <span class="o">*</span> <span class="n">slam120</span><span class="p">)</span>

        <span class="c1"># real B312</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">calp0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">))</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_C3f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">C3a</span><span class="p">)</span>
        <span class="n">B312</span> <span class="o">=</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">C3a</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">C3a</span><span class="p">))</span>
        <span class="n">domg12</span> <span class="o">=</span>  <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A3f</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">salp0</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig12</span> <span class="o">+</span> <span class="n">B312</span><span class="p">)</span>
        <span class="n">lam12</span> <span class="o">=</span> <span class="n">eta</span> <span class="o">+</span> <span class="n">domg12</span>

        <span class="k">if</span> <span class="n">diffp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">calp2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dlam12</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span> <span class="o">*</span> <span class="n">dn1</span> <span class="o">/</span> <span class="n">sbet1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dummy</span><span class="p">,</span> <span class="n">dlam12</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lengths</span><span class="p">(</span>
            <span class="n">eps</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span>
          <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">,</span> <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>
                <span class="n">dlam12</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span> <span class="o">/</span> <span class="p">(</span><span class="n">calp2</span> <span class="o">*</span> <span class="n">cbet2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlam12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">lam12</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span>
            <span class="n">domg12</span><span class="p">,</span> <span class="n">dlam12</span><span class="p">)</span>

    <span class="c1"># return a12, s12, salp1, calp1, salp2, calp2, m12, M12, M21, S12</span>
    <span class="k">def</span> <span class="nf">_GenInverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">outmask</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: General version of the inverse problem&quot;&quot;&quot;</span>
        <span class="n">a12</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">=</span> <span class="n">m12</span> <span class="o">=</span> <span class="n">M12</span> <span class="o">=</span> <span class="n">M21</span> <span class="o">=</span> <span class="n">S12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># return vals</span>

        <span class="n">outmask</span> <span class="o">&amp;=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">OUT_MASK</span>
        <span class="c1"># Compute longitude difference (AngDiff does this carefully).  Result is</span>
        <span class="c1"># in [-180, 180] but -180 is only for west-going geodesics.  180 is for</span>
        <span class="c1"># east-going and meridional geodesics.</span>
        <span class="n">lon12</span><span class="p">,</span> <span class="n">lon12s</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">AngDiff</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">)</span>
        <span class="c1"># Make longitude difference positive.</span>
        <span class="n">lonsign</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lon12</span><span class="p">)</span>
        <span class="n">lon12</span> <span class="o">=</span> <span class="n">lonsign</span> <span class="o">*</span> <span class="n">lon12</span><span class="p">;</span> <span class="n">lon12s</span> <span class="o">=</span> <span class="n">lonsign</span> <span class="o">*</span> <span class="n">lon12s</span>
        <span class="n">lam12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon12</span><span class="p">)</span>
        <span class="c1"># Calculate sincos of lon12 + error (this applies AngRound internally).</span>
        <span class="n">slam12</span><span class="p">,</span> <span class="n">clam12</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sincosde</span><span class="p">(</span><span class="n">lon12</span><span class="p">,</span> <span class="n">lon12s</span><span class="p">)</span>
        <span class="n">lon12s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="n">lon12</span><span class="p">)</span> <span class="o">-</span> <span class="n">lon12s</span> <span class="c1"># the supplementary longitude difference</span>

        <span class="c1"># If really close to the equator, treat as on equator.</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">AngRound</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">LatFix</span><span class="p">(</span><span class="n">lat1</span><span class="p">))</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">AngRound</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">LatFix</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span>
        <span class="c1"># Swap points so that point with higher (abs) latitude is point 1</span>
        <span class="c1"># If one latitude is a nan, then it becomes lat1.</span>
        <span class="n">swapp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">swapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lonsign</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">lat2</span><span class="p">,</span> <span class="n">lat1</span> <span class="o">=</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span>
        <span class="c1"># Make lat1 &lt;= 0</span>
        <span class="n">latsign</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">lat1</span><span class="p">)</span>
        <span class="n">lat1</span> <span class="o">*=</span> <span class="n">latsign</span>
        <span class="n">lat2</span> <span class="o">*=</span> <span class="n">latsign</span>
        <span class="c1"># Now we have</span>
        <span class="c1">#</span>
        <span class="c1">#     0 &lt;= lon12 &lt;= 180</span>
        <span class="c1">#     -90 &lt;= lat1 &lt;= 0</span>
        <span class="c1">#     lat1 &lt;= lat2 &lt;= -lat1</span>
        <span class="c1">#</span>
        <span class="c1"># longsign, swapp, latsign register the transformation to bring the</span>
        <span class="c1"># coordinates to this canonical form.  In all cases, 1 means no change was</span>
        <span class="c1"># made.  We make these transformations so that there are few cases to</span>
        <span class="c1"># check, e.g., on verifying quadrants in atan2.  In addition, this</span>
        <span class="c1"># enforces some symmetries in the results returned.</span>

        <span class="c1"># real phi, sbet1, cbet1, sbet2, cbet2, s12x, m12x</span>

        <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sincosd</span><span class="p">(</span><span class="n">lat1</span><span class="p">);</span> <span class="n">sbet1</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span>
        <span class="c1"># Ensure cbet1 = +epsilon at poles</span>
        <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">);</span> <span class="n">cbet1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">)</span>

        <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sincosd</span><span class="p">(</span><span class="n">lat2</span><span class="p">);</span> <span class="n">sbet2</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span>
        <span class="c1"># Ensure cbet2 = +epsilon at poles</span>
        <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">);</span> <span class="n">cbet2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">)</span>

        <span class="c1"># If cbet1 &lt; -sbet1, then cbet2 - cbet1 is a sensitive measure of the</span>
        <span class="c1"># |bet1| - |bet2|.  Alternatively (cbet1 &gt;= -sbet1), abs(sbet2) + sbet1 is</span>
        <span class="c1"># a better measure.  This logic is used in assigning calp2 in Lambda12.</span>
        <span class="c1"># Sometimes these quantities vanish and in that case we force bet2 = +/-</span>
        <span class="c1"># bet1 exactly.  An example where is is necessary is the inverse problem</span>
        <span class="c1"># 48.522876735459 0 -48.52287673545898293 179.599720456223079643</span>
        <span class="c1"># which failed with Visual Studio 10 (Release and Debug)</span>

        <span class="k">if</span> <span class="n">cbet1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">sbet1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cbet2</span> <span class="o">==</span> <span class="n">cbet1</span><span class="p">:</span>
                <span class="n">sbet2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">sbet1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sbet2</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="n">sbet1</span><span class="p">:</span>
                <span class="n">cbet2</span> <span class="o">=</span> <span class="n">cbet1</span>

        <span class="n">dn1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">sbet1</span><span class="p">))</span>
        <span class="n">dn2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">sbet2</span><span class="p">))</span>

        <span class="c1"># real a12, sig12, calp1, salp1, calp2, salp2</span>
        <span class="c1"># index zero elements of these arrays are unused</span>
        <span class="n">C1a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC1_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">C2a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC2_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">C3a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC3_</span><span class="p">))</span>

        <span class="n">meridian</span> <span class="o">=</span> <span class="n">lat1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">slam12</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">meridian</span><span class="p">:</span>

            <span class="c1"># Endpoints are on a single full meridian, so the geodesic might lie on</span>
            <span class="c1"># a meridian.</span>

            <span class="n">calp1</span> <span class="o">=</span> <span class="n">clam12</span><span class="p">;</span> <span class="n">salp1</span> <span class="o">=</span> <span class="n">slam12</span> <span class="c1"># Head to the target longitude</span>
            <span class="n">calp2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">salp2</span> <span class="o">=</span> <span class="mf">0.0</span>       <span class="c1"># At the target we&#39;re heading north</span>

            <span class="c1"># tan(bet) = tan(sig) * cos(alp)</span>
            <span class="n">ssig1</span> <span class="o">=</span> <span class="n">sbet1</span><span class="p">;</span> <span class="n">csig1</span> <span class="o">=</span> <span class="n">calp1</span> <span class="o">*</span> <span class="n">cbet1</span>
            <span class="n">ssig2</span> <span class="o">=</span> <span class="n">sbet2</span><span class="p">;</span> <span class="n">csig2</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">*</span> <span class="n">cbet2</span>

            <span class="c1"># sig12 = sig2 - sig1</span>
            <span class="n">sig12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">csig1</span> <span class="o">*</span> <span class="n">ssig2</span> <span class="o">-</span> <span class="n">ssig1</span> <span class="o">*</span> <span class="n">csig2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="n">csig1</span> <span class="o">*</span> <span class="n">csig2</span> <span class="o">+</span> <span class="n">ssig1</span> <span class="o">*</span> <span class="n">ssig2</span><span class="p">)</span>

            <span class="n">s12x</span><span class="p">,</span> <span class="n">m12x</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lengths</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span>
        <span class="n">outmask</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span> <span class="o">|</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">,</span> <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>

            <span class="c1"># Add the check for sig12 since zero length geodesics might yield m12 &lt;</span>
            <span class="c1"># 0.  Test case was</span>
            <span class="c1">#</span>
            <span class="c1">#    echo 20.001 0 20.001 0 | GeodSolve -i</span>
            <span class="c1">#</span>
            <span class="c1"># In fact, we will have sig12 &gt; pi/2 for meridional geodesic which is</span>
            <span class="c1"># not a shortest path.</span>
            <span class="k">if</span> <span class="n">sig12</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">m12x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sig12</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span> <span class="ow">or</span>
            <span class="c1"># Prevent negative s12 or m12 for short lines</span>
            <span class="p">(</span><span class="n">sig12</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tol0_</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s12x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">m12x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))):</span>
                    <span class="n">sig12</span> <span class="o">=</span> <span class="n">m12x</span> <span class="o">=</span> <span class="n">s12x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">m12x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>
                <span class="n">s12x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>
                <span class="n">a12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">sig12</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># m12 &lt; 0, i.e., prolate and too close to anti-podal</span>
                <span class="n">meridian</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># end if meridian:</span>

        <span class="c1"># somg12 == 2 marks that it needs to be calculated</span>
        <span class="n">somg12</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">comg12</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">omg12</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">meridian</span> <span class="ow">and</span>
        <span class="n">sbet1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>   <span class="c1"># and sbet2 == 0</span>
        <span class="c1"># Mimic the way Lambda12 works with calp1 = 0</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lon12s</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mi">180</span><span class="p">)):</span>

            <span class="c1"># Geodesic runs along equator</span>
            <span class="n">calp1</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">salp1</span> <span class="o">=</span> <span class="n">salp2</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">s12x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">lam12</span>
            <span class="n">sig12</span> <span class="o">=</span> <span class="n">omg12</span> <span class="o">=</span> <span class="n">lam12</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span>
            <span class="n">m12x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sig12</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">:</span>
                <span class="n">M12</span> <span class="o">=</span> <span class="n">M21</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sig12</span><span class="p">)</span>
            <span class="n">a12</span> <span class="o">=</span> <span class="n">lon12</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f1</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">meridian</span><span class="p">:</span>

            <span class="c1"># Now point1 and point2 belong within a hemisphere bounded by a</span>
            <span class="c1"># meridian and geodesic is neither meridional or equatorial.</span>

            <span class="c1"># Figure a starting point for Newton&#39;s method</span>
            <span class="n">sig12</span><span class="p">,</span> <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">,</span> <span class="n">dnm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_InverseStart</span><span class="p">(</span>
          <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">lam12</span><span class="p">,</span> <span class="n">slam12</span><span class="p">,</span> <span class="n">clam12</span><span class="p">,</span> <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sig12</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Short lines (InverseStart sets salp2, calp2, dnm)</span>
                <span class="n">s12x</span> <span class="o">=</span> <span class="n">sig12</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">*</span> <span class="n">dnm</span>
                <span class="n">m12x</span> <span class="o">=</span> <span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">dnm</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sig12</span> <span class="o">/</span> <span class="n">dnm</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">:</span>
                    <span class="n">M12</span> <span class="o">=</span> <span class="n">M21</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sig12</span> <span class="o">/</span> <span class="n">dnm</span><span class="p">)</span>
                <span class="n">a12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">sig12</span><span class="p">)</span>
                <span class="n">omg12</span> <span class="o">=</span> <span class="n">lam12</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f1</span> <span class="o">*</span> <span class="n">dnm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Newton&#39;s method.  This is a straightforward solution of f(alp1) =</span>
                <span class="c1"># lambda12(alp1) - lam12 = 0 with one wrinkle.  f(alp) has exactly one</span>
                <span class="c1"># root in the interval (0, pi) and its derivative is positive at the</span>
                <span class="c1"># root.  Thus f(alp) is positive for alp &gt; alp1 and negative for alp &lt;</span>
                <span class="c1"># alp1.  During the course of the iteration, a range (alp1a, alp1b) is</span>
                <span class="c1"># maintained which brackets the root and with each evaluation of f(alp)</span>
                <span class="c1"># the range is shrunk if possible.  Newton&#39;s method is restarted</span>
                <span class="c1"># whenever the derivative of f is negative (because the new value of</span>
                <span class="c1"># alp1 is then further from the solution) or if the new estimate of</span>
                <span class="c1"># alp1 lies outside (0,pi); in this case, the new starting guess is</span>
                <span class="c1"># taken to be (alp1a + alp1b) / 2.</span>
                <span class="c1"># real ssig1, csig1, ssig2, csig2, eps</span>
                <span class="n">numit</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tripn</span> <span class="o">=</span> <span class="n">tripb</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># Bracketing range</span>
                <span class="n">salp1a</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span><span class="p">;</span> <span class="n">calp1a</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">salp1b</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span><span class="p">;</span> <span class="n">calp1b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

                <span class="k">while</span> <span class="n">numit</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">maxit2_</span><span class="p">:</span>
                    <span class="c1"># the WGS84 test set: mean = 1.47, sd = 1.25, max = 16</span>
                    <span class="c1"># WGS84 and random input: mean = 2.85, sd = 0.60</span>
                    <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span>
           <span class="n">eps</span><span class="p">,</span> <span class="n">domg12</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lambda12</span><span class="p">(</span>
               <span class="n">sbet1</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">sbet2</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span>
             <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">,</span> <span class="n">slam12</span><span class="p">,</span> <span class="n">clam12</span><span class="p">,</span> <span class="n">numit</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">maxit1_</span><span class="p">,</span>
             <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">,</span> <span class="n">C3a</span><span class="p">)</span>
                    <span class="c1"># Reversed test to allow escape with NaNs</span>
                    <span class="k">if</span> <span class="n">tripb</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">8</span> <span class="k">if</span> <span class="n">tripn</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tol0_</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="c1"># Update bracketing values</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">numit</span> <span class="o">&gt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">maxit1_</span> <span class="ow">or</span>
                        <span class="n">calp1</span><span class="o">/</span><span class="n">salp1</span> <span class="o">&gt;</span> <span class="n">calp1b</span><span class="o">/</span><span class="n">salp1b</span><span class="p">):</span>
                        <span class="n">salp1b</span> <span class="o">=</span> <span class="n">salp1</span><span class="p">;</span> <span class="n">calp1b</span> <span class="o">=</span> <span class="n">calp1</span>
                    <span class="k">elif</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">numit</span> <span class="o">&gt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">maxit1_</span> <span class="ow">or</span>
                          <span class="n">calp1</span><span class="o">/</span><span class="n">salp1</span> <span class="o">&lt;</span> <span class="n">calp1a</span><span class="o">/</span><span class="n">salp1a</span><span class="p">):</span>
                        <span class="n">salp1a</span> <span class="o">=</span> <span class="n">salp1</span><span class="p">;</span> <span class="n">calp1a</span> <span class="o">=</span> <span class="n">calp1</span>

                    <span class="n">numit</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">numit</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">maxit1_</span> <span class="ow">and</span> <span class="n">dv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">dalp1</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span><span class="o">/</span><span class="n">dv</span>
                        <span class="n">sdalp1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dalp1</span><span class="p">);</span> <span class="n">cdalp1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dalp1</span><span class="p">)</span>
                        <span class="n">nsalp1</span> <span class="o">=</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">cdalp1</span> <span class="o">+</span> <span class="n">calp1</span> <span class="o">*</span> <span class="n">sdalp1</span>
                        <span class="k">if</span> <span class="n">nsalp1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dalp1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                            <span class="n">calp1</span> <span class="o">=</span> <span class="n">calp1</span> <span class="o">*</span> <span class="n">cdalp1</span> <span class="o">-</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">sdalp1</span>
                            <span class="n">salp1</span> <span class="o">=</span> <span class="n">nsalp1</span>
                            <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">)</span>
                            <span class="c1"># In some regimes we don&#39;t get quadratic convergence because</span>
                            <span class="c1"># slope -&gt; 0.  So use convergence conditions based on epsilon</span>
                            <span class="c1"># instead of sqrt(epsilon).</span>
                            <span class="n">tripn</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tol0_</span>
                            <span class="k">continue</span>
                    <span class="c1"># Either dv was not positive or updated value was outside</span>
                    <span class="c1"># legal range.  Use the midpoint of the bracket as the next</span>
                    <span class="c1"># estimate.  This mechanism is not needed for the WGS84</span>
                    <span class="c1"># ellipsoid, but it does catch problems with more eccentric</span>
                    <span class="c1"># ellipsoids.  Its efficacy is such for</span>
                    <span class="c1"># the WGS84 test set with the starting guess set to alp1 = 90deg:</span>
                    <span class="c1"># the WGS84 test set: mean = 5.21, sd = 3.93, max = 24</span>
                    <span class="c1"># WGS84 and random input: mean = 4.74, sd = 0.99</span>
                    <span class="n">salp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">salp1a</span> <span class="o">+</span> <span class="n">salp1b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">calp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">calp1a</span> <span class="o">+</span> <span class="n">calp1b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">)</span>
                    <span class="n">tripn</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">tripb</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">salp1a</span> <span class="o">-</span> <span class="n">salp1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">calp1a</span> <span class="o">-</span> <span class="n">calp1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tolb_</span> <span class="ow">or</span>
                   <span class="nb">abs</span><span class="p">(</span><span class="n">salp1</span> <span class="o">-</span> <span class="n">salp1b</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">calp1</span> <span class="o">-</span> <span class="n">calp1b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tolb_</span><span class="p">)</span>

                <span class="n">lengthmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">outmask</span> <span class="o">|</span>
                      <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span>
                       <span class="k">if</span> <span class="p">(</span><span class="n">outmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span> <span class="o">|</span>
                                      <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">))</span>
                       <span class="k">else</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">))</span>
                <span class="n">s12x</span><span class="p">,</span> <span class="n">m12x</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lengths</span><span class="p">(</span>
            <span class="n">eps</span><span class="p">,</span> <span class="n">sig12</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">dn1</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">dn2</span><span class="p">,</span> <span class="n">cbet1</span><span class="p">,</span> <span class="n">cbet2</span><span class="p">,</span>
          <span class="n">lengthmask</span><span class="p">,</span> <span class="n">C1a</span><span class="p">,</span> <span class="n">C2a</span><span class="p">)</span>

                <span class="n">m12x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>
                <span class="n">s12x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>
                <span class="n">a12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">sig12</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">AREA</span><span class="p">:</span>
                    <span class="c1"># omg12 = lam12 - domg12</span>
                    <span class="n">sdomg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">domg12</span><span class="p">);</span> <span class="n">cdomg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">domg12</span><span class="p">)</span>
                    <span class="n">somg12</span> <span class="o">=</span> <span class="n">slam12</span> <span class="o">*</span> <span class="n">cdomg12</span> <span class="o">-</span> <span class="n">clam12</span> <span class="o">*</span> <span class="n">sdomg12</span>
                    <span class="n">comg12</span> <span class="o">=</span> <span class="n">clam12</span> <span class="o">*</span> <span class="n">cdomg12</span> <span class="o">+</span> <span class="n">slam12</span> <span class="o">*</span> <span class="n">sdomg12</span>

        <span class="c1"># end elif not meridian</span>

        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">:</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="n">s12x</span>          <span class="c1"># Convert -0 to 0</span>

        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">:</span>
            <span class="n">m12</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="n">m12x</span>          <span class="c1"># Convert -0 to 0</span>

        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">AREA</span><span class="p">:</span>
            <span class="c1"># From Lambda12: sin(alp1) * cos(bet1) = sin(alp0)</span>
            <span class="n">salp0</span> <span class="o">=</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">cbet1</span>
            <span class="n">calp0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">calp1</span><span class="p">,</span> <span class="n">salp1</span> <span class="o">*</span> <span class="n">sbet1</span><span class="p">)</span> <span class="c1"># calp0 &gt; 0</span>
            <span class="c1"># real alp12</span>
            <span class="k">if</span> <span class="n">calp0</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">salp0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># From Lambda12: tan(bet) = tan(sig) * cos(alp)</span>
                <span class="n">ssig1</span> <span class="o">=</span> <span class="n">sbet1</span><span class="p">;</span> <span class="n">csig1</span> <span class="o">=</span> <span class="n">calp1</span> <span class="o">*</span> <span class="n">cbet1</span>
                <span class="n">ssig2</span> <span class="o">=</span> <span class="n">sbet2</span><span class="p">;</span> <span class="n">csig2</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">*</span> <span class="n">cbet2</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="n">calp0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ep2</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">))</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>
                <span class="c1"># Multiplier = a^2 * e^2 * cos(alpha0) * sin(alpha0).</span>
                <span class="n">A4</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">sq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">calp0</span> <span class="o">*</span> <span class="n">salp0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e2</span>
                <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">)</span>
                <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">)</span>
                <span class="n">C4a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Geodesic</span><span class="o">.</span><span class="n">nC4_</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_C4f</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">C4a</span><span class="p">)</span>
                <span class="n">B41</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">ssig1</span><span class="p">,</span> <span class="n">csig1</span><span class="p">,</span> <span class="n">C4a</span><span class="p">)</span>
                <span class="n">B42</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">_SinCosSeries</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">ssig2</span><span class="p">,</span> <span class="n">csig2</span><span class="p">,</span> <span class="n">C4a</span><span class="p">)</span>
                <span class="n">S12</span> <span class="o">=</span> <span class="n">A4</span> <span class="o">*</span> <span class="p">(</span><span class="n">B42</span> <span class="o">-</span> <span class="n">B41</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Avoid problems with indeterminate sig1, sig2 on equator</span>
                <span class="n">S12</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">meridian</span> <span class="ow">and</span> <span class="n">somg12</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
                <span class="n">somg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omg12</span><span class="p">);</span> <span class="n">comg12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omg12</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">meridian</span> <span class="ow">and</span>
          <span class="c1"># omg12 &lt; 3/4 * pi</span>
          <span class="n">comg12</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.7071</span> <span class="ow">and</span>   <span class="c1"># Long difference not too big</span>
          <span class="n">sbet2</span> <span class="o">-</span> <span class="n">sbet1</span> <span class="o">&lt;</span> <span class="mf">1.75</span><span class="p">):</span> <span class="c1"># Lat difference not too big</span>
                <span class="c1"># Use tan(Gamma/2) = tan(omg12/2)</span>
                <span class="c1"># * (tan(bet1/2)+tan(bet2/2))/(1+tan(bet1/2)*tan(bet2/2))</span>
                <span class="c1"># with tan(x/2) = sin(x)/(1+cos(x))</span>
                <span class="n">domg12</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">comg12</span><span class="p">;</span> <span class="n">dbet1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cbet1</span><span class="p">;</span> <span class="n">dbet2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cbet2</span>
                <span class="n">alp12</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">somg12</span> <span class="o">*</span> <span class="p">(</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">dbet2</span> <span class="o">+</span> <span class="n">sbet2</span> <span class="o">*</span> <span class="n">dbet1</span> <span class="p">),</span>
                                <span class="n">domg12</span> <span class="o">*</span> <span class="p">(</span> <span class="n">sbet1</span> <span class="o">*</span> <span class="n">sbet2</span> <span class="o">+</span> <span class="n">dbet1</span> <span class="o">*</span> <span class="n">dbet2</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># alp12 = alp2 - alp1, used in atan2 so no need to normalize</span>
                <span class="n">salp12</span> <span class="o">=</span> <span class="n">salp2</span> <span class="o">*</span> <span class="n">calp1</span> <span class="o">-</span> <span class="n">calp2</span> <span class="o">*</span> <span class="n">salp1</span>
                <span class="n">calp12</span> <span class="o">=</span> <span class="n">calp2</span> <span class="o">*</span> <span class="n">calp1</span> <span class="o">+</span> <span class="n">salp2</span> <span class="o">*</span> <span class="n">salp1</span>
                <span class="c1"># The right thing appears to happen if alp1 = +/-180 and alp2 = 0, viz</span>
                <span class="c1"># salp12 = -0 and alp12 = -180.  However this depends on the sign</span>
                <span class="c1"># being attached to 0 correctly.  The following ensures the correct</span>
                <span class="c1"># behavior.</span>
                <span class="k">if</span> <span class="n">salp12</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">calp12</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">salp12</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">tiny_</span> <span class="o">*</span> <span class="n">calp1</span>
                    <span class="n">calp12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">alp12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">salp12</span><span class="p">,</span> <span class="n">calp12</span><span class="p">)</span>
            <span class="n">S12</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c2</span> <span class="o">*</span> <span class="n">alp12</span>
            <span class="n">S12</span> <span class="o">*=</span> <span class="n">swapp</span> <span class="o">*</span> <span class="n">lonsign</span> <span class="o">*</span> <span class="n">latsign</span>
            <span class="c1"># Convert -0 to 0</span>
            <span class="n">S12</span> <span class="o">+=</span> <span class="mf">0.0</span>

        <span class="c1"># Convert calp, salp to azimuth accounting for lonsign, swapp, latsign.</span>
        <span class="k">if</span> <span class="n">swapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">salp2</span><span class="p">,</span> <span class="n">salp1</span> <span class="o">=</span> <span class="n">salp1</span><span class="p">,</span> <span class="n">salp2</span>
            <span class="n">calp2</span><span class="p">,</span> <span class="n">calp1</span> <span class="o">=</span> <span class="n">calp1</span><span class="p">,</span> <span class="n">calp2</span>
            <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">:</span>
                <span class="n">M21</span><span class="p">,</span> <span class="n">M12</span> <span class="o">=</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span>

        <span class="n">salp1</span> <span class="o">*=</span> <span class="n">swapp</span> <span class="o">*</span> <span class="n">lonsign</span><span class="p">;</span> <span class="n">calp1</span> <span class="o">*=</span> <span class="n">swapp</span> <span class="o">*</span> <span class="n">latsign</span>
        <span class="n">salp2</span> <span class="o">*=</span> <span class="n">swapp</span> <span class="o">*</span> <span class="n">lonsign</span><span class="p">;</span> <span class="n">calp2</span> <span class="o">*=</span> <span class="n">swapp</span> <span class="o">*</span> <span class="n">latsign</span>

        <span class="k">return</span> <span class="n">a12</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">,</span> <span class="n">m12</span><span class="p">,</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span><span class="p">,</span> <span class="n">S12</span>

<div class="viewcode-block" id="Geodesic.Inverse">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic.Inverse">[docs]</a>
    <span class="k">def</span> <span class="nf">Inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span>
              <span class="n">outmask</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve the inverse geodesic problem</span>

<span class="sd">        :param lat1: latitude of the first point in degrees</span>
<span class="sd">        :param lon1: longitude of the first point in degrees</span>
<span class="sd">        :param lat2: latitude of the second point in degrees</span>
<span class="sd">        :param lon2: longitude of the second point in degrees</span>
<span class="sd">        :param outmask: the :ref:`output mask &lt;outmask&gt;`</span>
<span class="sd">        :return: a :ref:`dict`</span>

<span class="sd">        Compute geodesic between (*lat1*, *lon1*) and (*lat2*, *lon2*).</span>
<span class="sd">        The default value of *outmask* is STANDARD, i.e., the *lat1*,</span>
<span class="sd">        *lon1*, *azi1*, *lat2*, *lon2*, *azi2*, *s12*, *a12* entries are</span>
<span class="sd">        returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a12</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">salp1</span><span class="p">,</span><span class="n">calp1</span><span class="p">,</span> <span class="n">salp2</span><span class="p">,</span><span class="n">calp2</span><span class="p">,</span> <span class="n">m12</span><span class="p">,</span> <span class="n">M12</span><span class="p">,</span> <span class="n">M21</span><span class="p">,</span> <span class="n">S12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GenInverse</span><span class="p">(</span>
        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">outmask</span><span class="p">)</span>
        <span class="n">outmask</span> <span class="o">&amp;=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">OUT_MASK</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">LONG_UNROLL</span><span class="p">:</span>
            <span class="n">lon12</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">AngDiff</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">)</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon1</span> <span class="o">+</span> <span class="n">lon12</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">AngNormalize</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat1&#39;</span><span class="p">:</span> <span class="n">Math</span><span class="o">.</span><span class="n">LatFix</span><span class="p">(</span><span class="n">lat1</span><span class="p">),</span>
              <span class="s1">&#39;lon1&#39;</span><span class="p">:</span> <span class="n">lon1</span> <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">LONG_UNROLL</span> <span class="k">else</span>
              <span class="n">Math</span><span class="o">.</span><span class="n">AngNormalize</span><span class="p">(</span><span class="n">lon1</span><span class="p">),</span>
              <span class="s1">&#39;lat2&#39;</span><span class="p">:</span> <span class="n">Math</span><span class="o">.</span><span class="n">LatFix</span><span class="p">(</span><span class="n">lat2</span><span class="p">),</span>
              <span class="s1">&#39;lon2&#39;</span><span class="p">:</span> <span class="n">lon2</span><span class="p">}</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;a12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a12</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s12</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">AZIMUTH</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">atan2d</span><span class="p">(</span><span class="n">salp1</span><span class="p">,</span> <span class="n">calp1</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;azi2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">atan2d</span><span class="p">(</span><span class="n">salp2</span><span class="p">,</span> <span class="n">calp2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;m12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m12</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">GEODESICSCALE</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;M12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M12</span><span class="p">;</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;M21&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M21</span>
        <span class="k">if</span> <span class="n">outmask</span> <span class="o">&amp;</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">AREA</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;S12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S12</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1"># return a12, lat2, lon2, azi2, s12, m12, M12, M21, S12</span>
    <span class="k">def</span> <span class="nf">_GenDirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">azi1</span><span class="p">,</span> <span class="n">arcmode</span><span class="p">,</span> <span class="n">s12_a12</span><span class="p">,</span> <span class="n">outmask</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private: General version of direct problem&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">geographiclib.geodesicline</span> <span class="kn">import</span> <span class="n">GeodesicLine</span>
        <span class="c1"># Automatically supply DISTANCE_IN if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arcmode</span><span class="p">:</span> <span class="n">outmask</span> <span class="o">|=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE_IN</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">GeodesicLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">azi1</span><span class="p">,</span> <span class="n">outmask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">_GenPosition</span><span class="p">(</span><span class="n">arcmode</span><span class="p">,</span> <span class="n">s12_a12</span><span class="p">,</span> <span class="n">outmask</span><span class="p">)</span>
 

    <span class="n">EMPTY</span>         <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">EMPTY</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;No capabilities, no output.&quot;&quot;&quot;</span>
    <span class="n">LATITUDE</span>      <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">LATITUDE</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate latitude *lat2*.&quot;&quot;&quot;</span>
    <span class="n">LONGITUDE</span>     <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">LONGITUDE</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate longitude *lon2*.&quot;&quot;&quot;</span>
    <span class="n">AZIMUTH</span>       <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">AZIMUTH</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate azimuths *azi1* and *azi2*.&quot;&quot;&quot;</span>
    <span class="n">DISTANCE</span>      <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">DISTANCE</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate distance *s12*.&quot;&quot;&quot;</span>
    <span class="n">STANDARD</span>      <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">STANDARD</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All of the above.&quot;&quot;&quot;</span>
    <span class="n">DISTANCE_IN</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">DISTANCE_IN</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allow distance *s12* to be used as input in the direct geodesic</span>
<span class="sd">  problem.&quot;&quot;&quot;</span>
    <span class="n">REDUCEDLENGTH</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">REDUCEDLENGTH</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate reduced length *m12*.&quot;&quot;&quot;</span>
    <span class="n">GEODESICSCALE</span> <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">GEODESICSCALE</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate geodesic scales *M12* and *M21*.&quot;&quot;&quot;</span>
    <span class="n">AREA</span>          <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">AREA</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate area *S12*.&quot;&quot;&quot;</span>
    <span class="n">ALL</span>           <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">ALL</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All of the above.&quot;&quot;&quot;</span>
    <span class="n">LONG_UNROLL</span>   <span class="o">=</span> <span class="n">GeodesicCapability</span><span class="o">.</span><span class="n">LONG_UNROLL</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unroll longitudes, rather than reducing them to the range</span>
<span class="sd">  [-180d,180d].</span>

<span class="sd">  &quot;&quot;&quot;</span></div>


<span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="p">(</span><span class="n">Constants</span><span class="o">.</span><span class="n">WGS84_a</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">WGS84_f</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Instantiation for the WGS84 ellipsoid&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Distance">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Distance">[docs]</a>
<span class="k">class</span> <span class="nc">Distance</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Modified to remve unit conversions to stay with RCAIDE conventions - Oct. 2024</span>
<span class="sd">    Base class for other distance algorithms. Represents a distance.</span>

<span class="sd">    Can be used for units conversion::</span>

<span class="sd">        &gt;&gt;&gt; from geopy.distance import Distance</span>
<span class="sd">        &gt;&gt;&gt; Distance(miles=10).km</span>
<span class="sd">        16.09344</span>

<span class="sd">    Distance instances have all *distance* properties from :mod:`geopy.units`,</span>
<span class="sd">    e.g.: ``km``, ``m``, ``meters``, ``miles`` and so on.</span>

<span class="sd">    Distance instances are immutable.</span>

<span class="sd">    They support comparison::</span>

<span class="sd">        &gt;&gt;&gt; from geopy.distance import Distance</span>
<span class="sd">        &gt;&gt;&gt; Distance(kilometers=2) == Distance(meters=2000)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; Distance(kilometers=2) &gt; Distance(miles=1)</span>
<span class="sd">        True</span>

<span class="sd">    String representation::</span>

<span class="sd">        &gt;&gt;&gt; from geopy.distance import Distance</span>
<span class="sd">        &gt;&gt;&gt; repr(Distance(kilometers=2))</span>
<span class="sd">        &#39;Distance(2.0)&#39;</span>
<span class="sd">        &gt;&gt;&gt; str(Distance(kilometers=2))</span>
<span class="sd">        &#39;2.0 km&#39;</span>
<span class="sd">        &gt;&gt;&gt; repr(Distance(miles=2))</span>
<span class="sd">        &#39;Distance(3.218688)&#39;</span>
<span class="sd">        &gt;&gt;&gt; str(Distance(miles=2))</span>
<span class="sd">        &#39;3.218688 km&#39;</span>

<span class="sd">    Arithmetics::</span>

<span class="sd">        &gt;&gt;&gt; from geopy.distance import Distance</span>
<span class="sd">        &gt;&gt;&gt; -Distance(miles=2)</span>
<span class="sd">        Distance(-3.218688)</span>
<span class="sd">        &gt;&gt;&gt; Distance(miles=2) + Distance(kilometers=1)</span>
<span class="sd">        Distance(4.218688)</span>
<span class="sd">        &gt;&gt;&gt; Distance(miles=2) - Distance(kilometers=1)</span>
<span class="sd">        Distance(2.218688)</span>
<span class="sd">        &gt;&gt;&gt; Distance(kilometers=6) * 5</span>
<span class="sd">        Distance(30.0)</span>
<span class="sd">        &gt;&gt;&gt; Distance(kilometers=6) / 5</span>
<span class="sd">        Distance(1.2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Distance.__init__">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        There are 3 ways to create a distance:</span>

<span class="sd">        - From kilometers::</span>

<span class="sd">            &gt;&gt;&gt; from geopy.distance import Distance</span>
<span class="sd">            &gt;&gt;&gt; Distance(1.42)</span>
<span class="sd">            Distance(1.42)</span>

<span class="sd">        - From points (for non-abstract distances only),</span>
<span class="sd">          calculated as a sum of distances between all points::</span>

<span class="sd">            &gt;&gt;&gt; from geopy.distance import geodesic</span>
<span class="sd">            &gt;&gt;&gt; geodesic((40, 160), (40.1, 160.1))</span>
<span class="sd">            Distance(14.003702498106215)</span>
<span class="sd">            &gt;&gt;&gt; geodesic((40, 160), (40.1, 160.1), (40.2, 160.2))</span>
<span class="sd">            Distance(27.999954644813478)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kilometers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kilometers&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># if we only get one argument we assume</span>
            <span class="c1"># it&#39;s a known distance instead of</span>
            <span class="c1"># calculating it first</span>
            <span class="n">kilometers</span> <span class="o">+=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kilometers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#elif len(args) &gt; 1:</span>
        <span class="c1">#    for a, b in  #util.pairwise(args):</span>
        <span class="c1">#kilometers +=  self.measure(a, b)</span>

        <span class="c1">#kilometers += units.kilometers(**kwargs)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__kilometers</span> <span class="o">=</span> <span class="n">kilometers</span></div>


    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Distance instance must be added with Distance instance.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="o">-</span><span class="n">other</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Distance instance must be multiplicated with numbers.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Distance instance must be multiplicated with numbers.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">/</span> <span class="n">other</span><span class="o">.</span><span class="n">kilometers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">//</span> <span class="n">other</span><span class="o">.</span><span class="n">kilometers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">//</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>

<div class="viewcode-block" id="Distance.measure">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.measure">[docs]</a>
    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># Intentionally not documented, because this method is not supposed</span>
        <span class="c1"># to be used directly.</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Distance is an abstract class&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Distance.destination">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Distance.destination">[docs]</a>
    <span class="k">def</span> <span class="nf">destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">bearing</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate destination point using a starting point, bearing</span>
<span class="sd">        and a distance. This method works for non-abstract distances only.</span>

<span class="sd">        Example: a point 10 miles east from ``(34, 148)``::</span>

<span class="sd">            &gt;&gt;&gt; import geopy.distance</span>
<span class="sd">            &gt;&gt;&gt; geopy.distance.distance(miles=10).destination((34, 148), bearing=90)</span>
<span class="sd">            Point(33.99987666492774, 148.17419994321995, 0.0)</span>

<span class="sd">        :param point: Starting point.</span>
<span class="sd">        :type point: :class:`geopy.point.Point`, list or tuple of ``(latitude,</span>
<span class="sd">            longitude)``, or string as ``&quot;%(latitude)s, %(longitude)s&quot;``.</span>

<span class="sd">        :param float bearing: Bearing in degrees: 0 -- North, 90 -- East,</span>
<span class="sd">            180 -- South, 270 or -90 -- West.</span>

<span class="sd">        :param distance: Distance, can be used to override</span>
<span class="sd">            this instance::</span>

<span class="sd">                &gt;&gt;&gt; from geopy.distance import distance, Distance</span>
<span class="sd">                &gt;&gt;&gt; distance(miles=10).destination((34, 148), bearing=90, \distance=Distance(100))</span>
<span class="sd">                Point(33.995238229104764, 149.08238904409637, 0.0)</span>

<span class="sd">        :type distance: :class:`.Distance`</span>

<span class="sd">        :rtype: :class:`geopy.point.Point`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Distance is an abstract class&quot;</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">return</span> <span class="s1">&#39;Distance(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> km&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__kilometers</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c1"># py2 only</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Distance</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kilometers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__kilometers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">km</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span></div>


<div class="viewcode-block" id="Geodesic_Calculate">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate">[docs]</a>
<span class="k">class</span> <span class="nc">Geodesic_Calculate</span><span class="p">(</span><span class="n">Distance</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the geodesic distance between points.</span>

<span class="sd">    Set which ellipsoidal model of the earth to use by specifying an</span>
<span class="sd">    ``ellipsoid`` keyword argument. The default is &#39;WGS-84&#39;, which is the</span>
<span class="sd">    most globally accurate model.  If ``ellipsoid`` is a string, it is</span>
<span class="sd">    looked up in the `ELLIPSOIDS` dictionary to obtain the major and minor</span>
<span class="sd">    semiaxes and the flattening. Otherwise, it should be a tuple with those</span>
<span class="sd">    values.  See the comments above the `ELLIPSOIDS` dictionary for</span>
<span class="sd">    more information.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from geopy.distance import geodesic</span>
<span class="sd">        &gt;&gt;&gt; newport_ri = (41.49008, -71.312796)</span>
<span class="sd">        &gt;&gt;&gt; cleveland_oh = (41.499498, -81.695391)</span>
<span class="sd">        &gt;&gt;&gt; print(geodesic(newport_ri, cleveland_oh).miles)</span>
<span class="sd">        538.390445368</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Geodesic_Calculate.__init__">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geod</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ellipsoid</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ellipsoid&#39;</span><span class="p">,</span> <span class="s1">&#39;WGS-84&#39;</span><span class="p">))</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Geodesic_Calculate.set_ellipsoid">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.set_ellipsoid">[docs]</a>
    <span class="k">def</span> <span class="nf">set_ellipsoid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6378.137</span><span class="p">,</span> <span class="mf">6356.7523142</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">298.257223563</span><span class="p">)</span> <span class="c1"># Assigns WGS-84 Ellipsoid parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid_key</span> <span class="o">=</span> <span class="n">ellipsoid</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid ellipsoid. See geopy.distance.ELLIPSOIDS&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span> <span class="o">=</span> <span class="n">ellipsoid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid_key</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Geodesic_Calculate.measure">
<a class="viewcode-back" href="../../../../../_autosummary/RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.html#RCAIDE.Library.Methods.Geodesics.Geodesics.Geodesic_Calculate.measure">[docs]</a>
    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1">#a, b = Point(a), Point(b)</span>
        <span class="c1">#_ensure_same_altitude(a, b)</span>
        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geod</span><span class="p">,</span> <span class="n">Geodesic</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geod</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geod</span><span class="o">.</span><span class="n">f</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geod</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELLIPSOID</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geod</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span>
                                <span class="n">Geodesic</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">)[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">s12</span></div>
</div>

    
<span class="n">GeodesicDistance</span> <span class="o">=</span> <span class="n">Geodesic_Calculate</span>
    
<span class="c1"># Set the default distance formula</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">GeodesicDistance</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2024, Laboratory for Electric Aircraft Design and Sustainability.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>